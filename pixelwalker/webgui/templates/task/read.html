{% extends "base.html" %}
{% load staticfiles %}

{% block tab_title %}{{ block.super }}: Tasks{% endblock %}

{% block nav %}
    <ul>
        <li><a href="{% url 'webgui:assessment_list' %}">Assessments</a></li>
        <li><a href="{% url 'webgui:media_list' %}">Media</a></li>
        <li><a href="{% url 'webgui:encoding_provider_list' %}">Encoding providers</a></li>
        <li><a href="{% url 'webgui:task_list' %}" class='active'>Tasks</a></li>
    </ul>
{% endblock %}

{% block options %}
    <ul>
        <li><a href='#' onclick='goBack()'><i class='fa fa-caret-left'></i> Back</a></li>
        {% if task.state < 2 %}
        <li><a href="{% url 'worker:task_abort'  task.id %}" class='warning'><i class='fa fa-times'></i> Abort</a></li>
        {% elif task.state == 2 %}
        <li><a href="{% url 'worker:task_retry'  task.id %}"><i class='fa fa-undo'></i> Redo</a></li>
        {% elif task.state > 2 %}
        <li><a href="{% url 'worker:task_retry'  task.id %}"><i class='fa fa-undo'></i> Retry</a></li>
        {% endif %}
        <li><a href="{% url 'webgui:task_delete'  task.id %}" class='warning'><i class='fa fa-trash'></i> Delete</a></li>
    </ul>
{% endblock %}

{% block content %}       
<h4><span class='info'>Task:</span> {{ task.id }}<br>
    {% if task.get_state_display == 'Queued' %}
    <span class="label label-default"><i class="fa fa-clock-o"></i> {{ task.get_state_display }}</span>
    {% elif task.get_state_display == 'Processing' %}
    <span class="label label-default"><i class="fa fa-cog"></i> {{ task.get_state_display }}</span>
    {% elif task.get_state_display == 'Aborted' %}
    <span class="label label-warning"><i class="fa fa-times"></i> {{ task.get_state_display }}</span>
    {% elif task.get_state_display == 'Error' %}
    <span class="label label-danger"><i class="fa fa-warning"></i> {{ task.get_state_display }}</span>
    {% elif task.get_state_display == 'Success' %}
    <span class="label label-success"><i class="fa fa-check"></i> {{ task.get_state_display }}</span>
    {% else %}
    <span class="label label-default">{{ task.get_state_display }}</span>
    {% endif %}
    </h4>

<table class='table table-striped table-condensed'>
    <thead>
        <tr>
            <th colspan='3'><i class='fa fa-exchange'></i> Relationships</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><b>Metric</b></td>
            <td><b>Assessment</b></td>
            <td><b>Media</b></td>
        </tr>
        <tr>
            <td>{{ task.metric.name }}</td>
            <td>
                {% if task.assessment %}
                <a href="{% url 'webgui:assessment_read'  task.assessment.id %}">{{ task.assessment.name }}</a>
                {% else %}
                <i>None</i>
                {% endif %}
            </td>
            <td><a href="{% url 'webgui:media_read'  task.media.id %}">{{ task.media.name }}</a></td>
        </tr>
    </tbody>
</table>

<table class='table table-striped table-condensed'>
    <thead>
        <tr>
            <th colspan='3'><i class='fa fa-calendar'></i> Time informations</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><b>Created</b></td>
            <td><b>Last queued</b></td>
            <td><b>Process started</b></td>
            <td><b>Process ended</b></td>
        </tr>
        <tr>
            <td>{{ task.date_created }}</td>
            <td>{{ task.date_queued }}</td>
            <td>{{ task.date_started }}</td>
            <td>{{ task.date_ended }}</td>
        </tr>
    </tbody>
</table>

{% endblock %}

{% block css_requirements %}
    {{ block.super }}
{% endblock %}

{% block js_requirements %}
    {{ block.super }}
{% endblock %}
